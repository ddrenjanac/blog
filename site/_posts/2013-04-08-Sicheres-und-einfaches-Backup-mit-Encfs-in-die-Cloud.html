---           
layout: post
title: Sicheres und einfaches Backup mit Encfs in die Cloud
date: 2013-04-08 21:53:04 UTC
updated: 2013-04-08 21:53:04 UTC
comments: true
categories: 
---

<p>Wie in <a href="http://blog.lgohlke.de/2013/02/encfs-reverse.html">encfs --reverse</a> schon angekündigt, stellt  <a href="http://www.arg0.net/encfs">encfs</a> eine einfache praktikable Lösung bereit, Klartext-Verzeichnise on-the-fly als verschlüsselte Verzeichnisse zu mounten.</p> <h2 style=""> Übersicht </h2>  Dazu bedarf es nur weniger Zeilen (1) und der Information zur Verschlüsselung im Klartextverzeichnis (2) <ol><li><pre class="brush:bash"> <br />encfs --reverse clear-text-directory directory-to-show-as-encrypted <br /></pre></li><li> <pre class="brush:bash"><br />$ ls -al<br />insgesamt 2768<br />drwxr-xr-x 10 lars lars    4096 Mär 15 15:18 .<br />drwxr-xr-x  3 lars lars    4096 Dez 17 23:46 ..<br />...<br />-rw-r--r--  1 lars lars    1090 Feb 13 10:39 .encfs6.xml<br />...<br /></pre></li></ol> Die Datei aus (2) bekommt man durch den klassischen Weg (Anlegen eines verschlüsselten Verzeichnisses) <pre class="brush:bash"> <br />encfs clear-text-directory directory-to-show-as-encrypted <br />...<br /></pre> Das Ganze mal in ein Skript verpackt, welches aus dem aktuellsten <a href="http://wiki.ubuntuusers.de/Back_In_Time">backintime</a> Verzeichnis meine Bilder in die Cloud sichert. (Die Cloud ist hier jetzt mein Server ;)) <p/> <h2>Praxisbeispiel</h2> Sie sieht die Ausführung aus: <pre class="brush:bash"><br />$ ./bilder_backup.sh <br />Give pw for encView<br />EncFS-Passwort: <br />insgesamt 3,1M<br />4,0K dr-xr-xr-x 10 lars lars 4,0K Mär 15 15:18 .<br />328K drwxrwxrwt 21 root root 324K Apr  8 22:20 ..<br />1,4M -r--r--r-- 14 lars lars 1,3M Sep  9  2012 72EM,II1<br />4,0K -r--r----- 17 lars lars  407 Jun 26  2006 8HFavTtakwyTC-<br />4,0K -r--r--r--  8 lars lars 1,1K Feb 13 10:39 cZcEr1j6cPnLRha10,<br />292K -r--r----- 17 lars lars 292K Jun  7  2005 gbrODCTZU3wCc9JgQsusQz-5<br />4,0K dr-xr-xr-x  7 lars lars 4,0K Sep  9  2012 Ki4-qaws1mXW<br />4,0K dr-xr-xr-x 24 lars lars 4,0K Mär 14 17:25 KW,cCDCPQgQA<br />388K -r--r----- 17 lars lars 386K Jan  2  2005 kykBT6MBxWsN7Rs4usZjBZyOKITWbBC<br />4,0K dr-xr-x---  3 lars lars 4,0K Nov  9  2009 loVuTdSv6Rcx1vRqzXMMDFaFF-j-32OmZo7<br />4,0K -r-xr-xr-x 17 lars lars  233 Jun 26  2006 meqPWsFAIhi1<br />4,0K dr-xr-x---  3 lars lars 4,0K Jan 12  2010 ny8KaOyd0hQ8S0<br />4,0K dr-xr-x---  2 lars lars 4,0K Okt 23  2009 teUPxPhzK3bXr1<br />4,0K dr-xr-xr-x 12 lars lars 4,0K Sep 15  2010 twep7Wbbb1uN<br />4,0K dr-x------  8 lars lars 4,0K Okt 21 15:19 v4ZC-SmXGf3<br />352K -r--r----- 17 lars lars 351K Apr  3  2005 XL7z8lqo0OqMpZlx91<br />4,0K dr-xr-xr-x  7 lars lars 4,0K Apr  9  2008 xP-CpRIY9YcqybC,HOLNkWqW<br />352K -r--r----- 17 lars lars 351K Aug 30  2006 xqI6SUadWF9PR-556ChJF6-VWVM0eCB<br />building file list ... <br />20080 files to consider<br />Ki4-qaws1mXW/wNovM37-LeKdn00/ErfqKTMMk4r0dFPCqxGX-sv9fLNX/<br />Ki4-qaws1mXW/wNovM37-LeKdn00/ErfqKTMMk4r0dFPCqxGX-sv9fLNX/hz0wj1FP6JLTDeC/<br />Ki4-qaws1mXW/wNovM37-LeKdn00/ErfqKTMMk4r0dFPCqxGX-sv9fLNX/hz0wj1FP6JLTDeC/2sTxd26gZ1fkEACTyEkga3KuEGGm4m2UElmRF5knNre1YZyutl2nKsf,VwEuYX8<br />         262 100%    0.00kB/s    0:00:00 (xfer#1, to-check=11491/20080)<br /><br />Number of files: 20080<br />Number of files transferred: 1<br />Total file size: 96218876503 bytes<br />Total transferred file size: 262 bytes<br />Literal data: 262 bytes<br />Matched data: 0 bytes<br />File list size: 687638<br />File list generation time: 3.391 seconds<br />File list transfer time: 0.000 seconds<br />Total bytes sent: 687964<br />Total bytes received: 41<br /><br />sent 687964 bytes  received 41 bytes  65524.29 bytes/sec<br />total size is 96218876503  speedup is 139852.00<br /></pre> und so das Skript dazu: <pre class="brush:bash"><br />#!/bin/bash<br /><br />set -e<br />#set -x <br /><br />pathToImages=home/lars/remote/lars/volume_i/bilder/<br />lastBackup=$(find /backup/backintime/lars-G33-DS3R/lars/1 -maxdepth 1 -type d |  sort -n | tail -n1)<br /><br />path=$lastBackup/backup/$pathToImages<br /><br />pathToEncView=$(tempfile).d<br />mkdir $pathToEncView<br /><br />echo Give pw for encView<br />encfs --reverse $path $pathToEncView<br /><br />ls -alsh $pathToEncView<br /><br />continue=1<br />while( [ $continue == 1 ] );<br />do<br />        rsync -v --stats --progress -e ssh  --partial --archive --delete-after --log-file=log  $pathToEncView/* wirt2.lgohlke.de:/backup/uploaded/Bilder/.backend && continue=0 || sleep 1<br />done<br /><br /><br />sudo umount $pathToEncView<br />rmdir $pathToEncView<br /></pre> Das Skript mounted die Sicht auf das verschlüsselte Verzeichnis in ein temporäres Verzeichnis (Zeile 11) und löscht dieses wieder (Zeile 27).<br/>Das Hochladen der Bilder erfolgt über rsync+ssh und wird so lange wiederholt, bis das Backup erfolgreich war und nicht zwischendurch abgebrochen ist.<p/> <h2>Fazit</h2><ol><li>Mit ausreichender Verschlüsselung sind die Daten sicher!</li><li>Damit kann nun auch Dropbox o.ä. genutzt werden. Dorthinein mounten und hochladen lassen.</li></ol>