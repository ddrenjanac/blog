---           
layout: post
title: Datenschutz auf dem Blocklevel bei Rootservern
date: 2013-02-11 15:38:00 UTC
updated: 2013-02-11 15:38:00 UTC
comments: true
categories: linux server
---

Ich habe vor kurzem meinen Server umgezogen, wie in <a href="http://blog.lgohlke.de/2013/01/serverborse-bei-hetzner.html">Serverbörse bei Hetzner</a> angekündigt. Dabei ging es mir vorallem um mehr Speicherplatz. Die Kapazität ohne monatliche Mehrkosten konnte ich von 750GB auf 3TB erhöhen.</p> So ein Umzug ist auch immer ein Neuanfang. Ja, so pathetisch wie es klingt, so denkt man auch ... ganz kurz. Ich habe mir vorgenommen einige Sachen besser zu machen.<p/> Bei meinem letzten Umzug waren die großen Veränderungen, dass ich die einzelnen Dienste in autonome virtuelle Maschine portiert. Diese VMs laufen nun in einem virtuellen Netz auf dem Server, mittels Virtualbox. Läuft alles wunderbar und man kann schnell mal experimentieren und neue VMs dazupacken.<p/> Bei <i>diesem</i> Umzug war mir Datensicherheit sehr wichtig. Zeitgleich ist mir zuhause eine 2TB Platte peu-à-peu kaputt gegangen. Beim Dumpen der Daten ist mir dann wieder bewußt geworden, dass auch lokal bei 100MB/s immer noch knappe 6h zum Kopieren notwendig sind. Ich versuche meine kaputten Platten vor dem Verschrotten meistens noch einige Runden zu shreddern.<br/>Bei meinem neuen Rootserver habe ich mir überlegt mit einer Basisverschlüsselung, kann ich mir das Shreddern sparen. Dank AES und schnellen Prozessoren ist der Leistungsabfall recht gering und verschmerzbar.<p/> <strong>Ziel: Absicherung bei Server-/Festplattentausch</strong> <h3>Vorgehensweise:</h3> Aufbauend auf diesen Anleitungen <a href="http://www.andreas-janssen.de/cryptodisk.html">Festplattenverschlüsselung mit Debian GNU/Linux</a> und <a href="https://systemausfall.org/wikis/howto/CryptoPartitionHowTo">CryptoPartitionHowTo</a> habe ich <tt>cryptsetup</tt> eingesetzt.   Die Formatierung, wie in den Anleitungen angegeben (mit luks) und dann ...<p/> <tt>/etc/crypttab</tt><pre class="brush:bash;gutter: false;"><br />...<br />crypted-md2     /dev/md2        /etc/disk.key   luks<br />...<br /></pre> <tt>lvm config</tt><pre class="brush:bash;gutter: false;"><br /># lvs<br />  LV         VG          Attr     LSize   Pool Origin Data%  Move Log Copy%  Convert<br />  vm         raid1       -wi-ao-- 400.00g<br />...<br /></pre>  <tt>/etc/fstab</tt><pre class="brush:bash;gutter: false;"><br />...<br />/dev/raid1/vm                   /vm             ext4 defaults 0 0<br />...<br /></pre> <h3>kleines Benchmark</h3> Zuerst von der &quot;rohen&quot; Festplatte, dann vom verschlüsselten Gerät. Der Arbeitspeicher hat die Größe von 12GB, daher nehme ich zum Test mehr, dass mir kein Caching dazwischen kommt.  <pre class="brush:bash;gutter: false;"><br />root@wirt2:~# hdparm -t /dev/sda<br /><br />/dev/sda:<br /> Timing buffered disk reads: 356 MB in  3.00 seconds = 118.53 MB/sec<br /></pre> von der Festplatte <tt>/dev/sda</tt><pre class="brush:bash; gutter:false;"><br />root@wirt2:/vm# time dd if=/dev/sda bs=1M count=10k  > /dev/null<br />10240+0 records in<br />10240+0 records out<br />10737418240 bytes (11 GB) copied, 82.7227 s, 130 MB/s<br /><br />real 1m22.725s<br />user 0m0.404s<br />sys 0m22.109s<br /></pre>  aus der Datei <tt>/vm/x</tt><pre class="brush:bash; gutter:false;"><br />root@wirt2:/vm# time dd if=x bs=1M count=10k > /dev/null<br />10240+0 records in<br />10240+0 records out<br />10737418240 bytes (11 GB) copied, 80.9839 s, 133 MB/s<br /><br />real 1m20.986s<br />user 0m0.248s<br />sys 0m16.261s<br /></pre> Aufgrund der Zahlen läßt sich abschätzen, dass die Grundverschlüsselung bei heutigen Prozessoren durchaus tragbar ist, sofern die Last niedrig bis mittel ist. Mit <a href="http://datacenteroverlords.com/2011/09/07/aes-ni-pimp-your-aes/">AES-NI</a> sollte es dann weiter im Grundrauschen versinken. (Auf diesem Server ist ein i7 CPU 975 @ 3.33GHz.)