---
layout: post
title: Short debian package guide for dummies
date: 2015-04-07 21:23:07 UTC
updated: 2015-04-07 13:36:07 UTC
comments: true
categories: ubuntu
# news | tip | story
hint-type: story
---

<div>
    As I always struggle with creating a debian so I decided to write the few steps down. Finally. This is more a kind of cheat sheet than a comprehensive guide.<br/>
    In my example I will package <a href="https://github.com/h2o/h2o">h2o</a> a very fast http/2 static file server capable to run as reverse proxy.
</div>

<p>This is my environment:
{% highlight bash %}
$ lsb_release -a
No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu 14.04.2 LTS
Release:	14.04
Codename:	trusty
{% endhighlight %}</p>

<h2>1. creating the basic structure</h2>

clone repository and change to newly created branch

{% highlight bash %}
$ git clone git@github.com:lkwg82/h2o.git
$ git checkout tags/v1.1.1
$ git branch debian
$ git checkout debian
$ git branch --track origin/master
{% endhighlight %}

create the debian structure as directory <tt>debian/</tt>.

{% highlight bash %}
$ export DEBEMAIL=lkwg82@gmx.de
$ export DEBFULLNAME="Lars K.W. Gohlke"
$ dh_make --single -p h2o-server_1.1.1 --createorig -y
{% endhighlight %}

<div class="info">
    <tt>DEBEMAIL</tt> and <tt>DEBFULLNAME</tt> should be the same as in your gpg keys, which you are using to sign the package.
</div>

<p>Now fill the generated files under <tt>debian/</tt> (control/changelog) and check with <tt>lintian</tt> until there are no more errors. Commit all changes!</p>

{% highlight bash %}
$ lintian
Too late to run INIT block at /usr/local/lib/perl/5.18.2/Net/DNS.pm line 213.
W: h2o-server source: native-package-with-dash-version
W: h2o-server source: package-needs-versioned-debhelper-build-depends 9
W: h2o-server source: vcs-field-uses-unknown-uri-format vcs-git git@github.com:h2o/h2o.git
W: h2o-server source: syntax-error-in-dep5-copyright line 11: Continuation line outside a paragraph (maybe line 10 should be " .").
W: h2o-server source: out-of-date-standards-version 3.9.4 (current is 3.9.5)
W: h2o-server source: debian-watch-file-in-native-package
{% endhighlight %}

<div class="info">
    <h3>about preparation for publishing</h3>

    <p>I publish my packages on <a href="https://launchpad.net/~lkwg82">launchpad</a>. For this I recommend to make sure every needed <a href="https://www.debian.org/doc/debian-policy/ch-relationships.html">build dependency</a> is met.</p>

    <p>I struggled with <a href="http://pbuilder.alioth.debian.org/">pbuilder</a> so I chose <a href="http://www.docker.com">docker</a> to have a clean build environment. For this I wrote <a href="https://github.com/lkwg82/docker-debian-build-env">docker-debian-build-env</a>.</p>

    <p>A single command runs a clean ubuntu instance and build everything:
        {% highlight bash %}$ docker_debian_build_all{% endhighlight %}
    </p>

    <p>If you struggle with both ... loop until no errors left.</p>
</div>

<h2>2. Finish</h2>

<p>Finish your (initial) changes with these steps:</p>

Build a binary package:
{% highlight bash %}
$ dpkg-buildpackage -tc -B
{% endhighlight %}

or build a source package for publishing on launchpad:

{% highlight bash %}
$ git-dch --release --git-author --commit --id-length=10 --distribution=trusty --debian-branch=debian
$ git-buildpackage -S -sa --git-tag --git-sign-tags --git-no-create-orig --git-debian-branch=debian
{% endhighlight %}

In both cases the result is in the parent directory.

<h2>3. Publish!</h2>

<p>Share your package with the community. Make a pull request to the original authors and let everyone know you packaged that software for easy use (hopfully).</p>

{% highlight bash %}
$ dput ppa:lkwg82/webperformance ../h2o-server_1.1.1-2_source.changes
{% endhighlight %}

<p>My result is here <a href="https://launchpad.net/~lkwg82/+archive/ubuntu/webperformance">ppa:lkwg82/webperformance</a>.</p>

<p>Feedback is welcome!</p>

<hr>
<h3>Links</h3>
<ul>
    <li><a href="https://www.v13.gr/blog/?p=364">automatically install build dependencies</a></li>
    <li><a href="http://packaging.ubuntu.com/html/">ubuntu packaging guide</a></li>
    <li><a href="https://help.launchpad.net/Packaging/PPA/Uploading">launchpad uploading a package</a></li>
</ul>

