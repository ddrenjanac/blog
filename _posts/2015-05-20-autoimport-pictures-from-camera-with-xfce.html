---
layout: post
title: Automatischer Bilderimport beim Anschluss der Kamera
subtitle: mit Thunar unter Xfce
date: 2015-05-20 21:23:07 UTC
updated: 2015-05-20 13:36:07 UTC
comments: true
categories: ubuntu thunar gphoto2 renrot
published: true
# news | tip | story
hint-type: story
---

<div>
    Da ich unter Ubuntu nichts ad&auml;quates finde, um automatisch meine Bilder zu importieren. Habe ich das Ganze mit einem Shellskript und <a href="http://de.wikipedia.org/wiki/Thunar">Thunar</a> (ist der Dateimanager von <a href="http://xfce.org/">Xfce</a>) gel&ouml;st. Der Import startet sobald die Kamera erkannt wird.
</div>

<p>Folgende Anwendungen bitte installieren:</p>
{% highlight bash %}
sudo apt-get install gphoto2 renrot
{% endhighlight %}


Dieses Skipt unter <tt>~/bin/importBilder.sh</tt> ablegen.

{% highlight bash %}
#!/bin/bash

set -e

exitEnter()     { echo $1; echo "press ENTER to exit"; read; exit 1; }
checkInstalled(){
    printf "checking %-30s installed : "  $1;
    type $1 >/dev/null 2>&1 && echo "ok" || { echo "fail"; exitEnter; }
}

checkInstalled gphoto2
checkInstalled renrot
checkInstalled thunar
# optional
# checkInstalled convertCamVideo2ArchivVideo.sh

imageFolder=$(echo ~/Bilder)

serialNumber=$( gphoto2 --get-config /main/status/eosserialnumber | grep ^Current | cut -d\  -f2)  || { exitEnter; }

doImport(){
    timestamp=$(printf %s $(date +"%Y%m%d_%H%M"))
    local folder="$imageFolder/autoimport_$timestamp"
    mkdir -p $folder
    cd $folder && gphoto2 -P

    # use exif to rename the file
    renrot --mtime --name-template "%Y%m%d_%H%M_%n" *.JPG

    mkdir _jpeg_original
    mv *JPG_orig _jpeg_original/

    mkdir raw
    mv *CR2 raw/

    # transcoding video to lower file size
    # convertCamVideo2ArchivVideo.sh

    echo
    echo "finished import into '$folder'"
    echo
    echo "press Enter to exit"
    read

    thunar $folder
}

# only import from a specific camera, not any other
if [ $serialNumber -eq 2131234489 ]; then
    doImport
fi
{% endhighlight %}

<div class="image">
    <a class="fancybox-thumb" rel="fancybox-thumb" href="/img/posts/2015-05-20-version-thunrar.jpg" title="Version von Thunar">
        <img src="/img/posts/2015-05-20-version-thunrar-small.jpg" alt="" />
    </a>
    <a class="fancybox-thumb" rel="fancybox-thumb" href="/img/posts/2015-05-20-advanced-settings-thunrar.jpg" title="Erweiterte Eigenschaften">
        <img src="/img/posts/2015-05-20-advanced-settings-thunrar-small.jpg" alt="" />
    </a>
    <a class="fancybox-thumb" rel="fancybox-thumb" href="/img/posts/2015-05-20-camera-volumd.jpg" title="Volumed Eigenschaften">
        <img src="/img/posts/2015-05-20-camera-volumd-small.jpg" alt="" />
    </a>
    <a class="fancybox-thumb" rel="fancybox-thumb" href="/img/posts/2015-05-20-terminal.jpg" title="Terminalausgabe wenn die Kamera angeschlossen wird">
        <img src="/img/posts/2015-05-20-terminal-small.jpg" alt="" />
    </a>
    <a class="fancybox-thumb" rel="fancybox-thumb" href="/img/posts/2015-05-20-thunar.jpg" title="So sieht es dann im Browser aus">
        <img src="/img/posts/2015-05-20-thunar-small.jpg" alt="" />
    </a>
</div>

<style>.image img{ max-width:150px;}</style>

<!-- Add jQuery library -->
<script type="text/javascript" src="/js/fancybox-1.2.5/lib/jquery-1.10.1.min.js"></script>

<!-- Add mousewheel plugin (this is optional) -->
<script type="text/javascript" src="/js/fancybox-1.2.5/lib/jquery.mousewheel-3.0.6.pack.js"></script>

<!-- Add fancyBox main JS and CSS files -->
<script type="text/javascript" src="/js/fancybox-1.2.5/source/jquery.fancybox.js?v=2.1.5"></script>
<link rel="stylesheet" type="text/css" href="/js/fancybox-1.2.5/source/jquery.fancybox.css?v=2.1.5" media="screen" />

<!-- Add Button helper (this is optional) -->
<link rel="stylesheet" type="text/css" href="/js/fancybox-1.2.5/source/helpers/jquery.fancybox-buttons.css?v=1.0.5" />
<script type="text/javascript" src="/js/fancybox-1.2.5/source/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>

<!-- Add Thumbnail helper (this is optional) -->
<link rel="stylesheet" type="text/css" href="/js/fancybox-1.2.5/source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" />
<script type="text/javascript" src="/js/fancybox-1.2.5/source/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>

<!-- Add Media helper (this is optional) -->
<script type="text/javascript" src="/js/fancybox-1.2.5/source/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<!--<script type="text/javascript" src="/js/fancybox-1.2.5/source/jquery.fancybox.pack.js"></script>-->

<script>
    $(document).ready(function() {

	$(".fancybox-thumb").fancybox({
		prevEffect	: 'none',
		nextEffect	: 'none',
		helpers	: {
			title	: {
				type: 'outside'
			},
			thumbs	: {
				width	: 50,
				height	: 50
			}
		}
	});
});
</script>

So sieht dann die Ausgabe aus:

{% highlight bash %}
checking gphoto2                        installed : ok
checking renrot                         installed : ok
checking thunar                         installed : ok

Downloading 'IMG_0210.CR2' from folder '/store_00020001/DCIM/101CANON'...
Speichere Datei als IMG_0210.CR2
Downloading 'IMG_0210.JPG' from folder '/store_00020001/DCIM/101CANON'...
Speichere Datei als IMG_0210.JPG

...

Downloading 'IMG_0220.CR2' from folder '/store_00020001/DCIM/101CANON'...
Speichere Datei als IMG_0220.CR2
Downloading 'IMG_0220.JPG' from folder '/store_00020001/DCIM/101CANON'...
Speichere Datei als IMG_0220.JPG

RENAMING / ROTATING
===================
Processing file: (1 of 11) IMG_0210.JPG...
Renamed: IMG_0210.JPG -> 20150515_1406_IMG_0210.JPG

...

Processing file: (11 of 11) IMG_0220.JPG...
Renamed: IMG_0220.JPG -> 20150515_1416_IMG_0220.JPG


finished import into '/home/lars/Bilder/autoimport_20150520_1027'

press Enter to exit
{% endhighlight %}


<p>Viel Spa&szlig; damit!</p>